# SCPI Command Sender

SCPI Command Sender 是一个用于通过TCP/IP与上位机系统进行通信的图形化工具。该工具提供了直观的用户界面，支持SCPI风格命令的批量执行和预设配置管理。

## 功能特点

- 📡 通过 TCP/IP 连接到上位机系统
- 🔄 支持单条命令和命令序列的执行
- ⏱️ 可配置命令执行的重复次数和时间间隔
- 💾 预设配置的保存和加载
- 📝 实时命令执行日志
- 🛡️ 完善的错误处理和用户提示

## 系统要求

- Python 3.6+
- PyQt5 5.15.11+

## 安装

1. 克隆或下载项目代码
2. 安装依赖：
```bash
pip install -r requirements.txt
```

## 使用说明

### 启动程序

```bash
python scpi_gui.py
```

### 连接上位机

1. 在连接设置区域输入上位机的 IP 地址和端口号
2. 点击"连接"按钮建立连接
3. 连接状态会实时显示在界面上

### 发送命令

1. 在命令输入框中输入 SCPI 命令
2. 点击"添加"将命令添加到命令列表
3. 设置执行次数和时间间隔
4. 点击"执行命令"开始发送

### 使用预设配置

程序内置了几个常用的预设配置：

- **Basic Query**: 基本查询命令（*IDN?, *OPT?, *STB?）
- **Clear and Run**: 清除并运行采集
- **Measurement Setup**: 测量设置和数据获取

您也可以：
- 加载自定义的预设配置文件（JSON格式）
  ```json
  {
    "name": "配置名称",
    "description": "配置描述",
    "commands": ["SCPI命令1", "SCPI命令2"],
    "repeat": 1,
    "interval": 0.5
  }
  ```
- 将当前的命令序列保存为新的预设配置

## 项目结构

```
.
├── requirements.txt    # 项目依赖
├── scpiconfig.json    # 配置文件
├── scpi_backend.py    # 后端实现
├── scpi_gui.py        # 图形界面实现
└── logger.py          # 日志记录模块
```

### 核心模块

- **SCPIInstrument**: 实现与上位机的基础通信功能
  - 连接管理
  - 命令发送
  - 响应接收
  - 错误处理

- **SCPIGUI**: 提供图形用户界面
  - 连接设置
  - 命令管理
  - 预设配置
  - 执行控制
  - 结果显示

- **Logger**: 实现执行日志记录
  - 多级别日志记录(INFO/WARNING/ERROR)
  - 按日期自动创建日志文件
  - 记录命令执行详情
  - 错误追踪和时间戳

## 错误处理

程序会处理以下常见错误：
- 连接超时
- 连接被拒绝
- 命令执行超时
- 命令格式错误
- 仪器响应错误

## 开发说明

### 添加新功能

1. 在 `scpi_backend.py` 中添加新的通信功能
2. 在 `scpi_gui.py` 中添加相应的界面元素
3. 在预设配置中添加新的命令序列

### 调试建议

- 使用内置的日志功能查看命令执行情况
  - 日志文件存储在`logs/`目录下
  - 日志文件按日期命名(如`2023-11-15.log`)
  - 日志内容包括时间戳、日志级别、执行详情
- 检查网络连接和防火墙设置
- 确保仪器支持相应的 SCPI 命令

## 注意事项

- 确保上位机的 SCPI 服务已启用
- 检查网络连接和防火墙设置
- 注意命令格式的正确性
- 合理设置命令执行间隔，避免仪器负载过高

## 许可证

[MIT License](https://opensource.org/licenses/MIT)